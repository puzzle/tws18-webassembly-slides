<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>WebAssembly Mini Workshop</title>
        <link rel="stylesheet" href="./css/reveal.css">
        <link rel="stylesheet" href="./theme/puzzle.css" id="theme">
        <link rel="stylesheet" href="./css/highlight/zenburn.css">
        <link rel="stylesheet" href="./css/print/paper.css" type="text/css" media="print">

    </head>
    <body>

        <div class="reveal">
            <div class="slides"><section  data-markdown><script type="text/template">

<!-- .slide: class="master01" -->

# WebAssembly<br>Mini Workshop
</script></section><section  data-markdown><script type="text/template">
<!-- .slide: class="master02" -->

# Overview
</script></section><section  data-markdown><script type="text/template">
## WebAssembly (Wasm)

* Web standard complementary to JavaScript
* Bytecode for browsers
* Compilation target for C/C++ and other languages
* LLVM backend
* Compressed binary and text representation
</script></section><section  data-markdown><script type="text/template">
## WebAssembly (Wasm)

* Near native execution speed
* Sandboxing like JavaScript
* Successor to asm.js and Google NaCl
* Designed for Browsers, Mobile, IoT, ...
</script></section><section  data-markdown><script type="text/template">
## WebAssembly MVP

* MVP in Firefox 52, Chrome 57, Edge 16, Safari 11
* MVP based on features available in todays browsers that perform well on mobile
* MVP has roughly same functionality as asm.js
* All execution environments implement the same specification
* Includes wasm32 only (32-bit)
</script></section><section  data-markdown><script type="text/template">
## WebAssembly Roadmap

* W3C Working Group
* Thread Support
* Zero Cost Exception Support
* Garbage Collector Support
* Direct access to DOM/Web API
* SIMD Support
</script></section><section  data-markdown><script type="text/template">
## asm.js

* Low-level subset of JavaScript
* Limited to ahead-of-time optimizable features
* Compilation target for C/C++ and other languages
* asm.js optimizations in some browser
* Performance inconsistent accross browsers
</script></section><section  data-markdown><script type="text/template">
### Why is WebAssembly faster than asm.js?

* Much faster parsing due to binary format
* Better support for modern CPU features
* More efficient memory access
* Toolchain improvements
* Predictable performance across browsers
</script></section><section  data-markdown><script type="text/template">
## Emscripten

* LLVM to asm.js/Wasm compiler
* Can compile practically any portable C/C++ code
* Support for SDL and OpenGL ES 2.0
* Support for OpenAL
* Focused on portability
</script></section><section  data-markdown><script type="text/template">
## NodeJS WebAssembly Package

* C/C++ to Wasm compiler
* Targeting Wasm in browsers only
* Minimal boilerplate code
</script></section><section  data-markdown><script type="text/template">
## TeaVM

* Java bytecode to asm.js/Wasm compiler
* Green Thread support
* Sophisticated optimizer
* Source Maps
* GC implemented in Java
</script></section><section  data-markdown><script type="text/template">
## AssemblyScript

* Strictly typed subset of TypeScript
* Compiles to WebAssembly
</script></section><section  data-markdown><script type="text/template">
## WebAssembly Types

* i32: 32-bit integer
* i64: 64-bit integer
* f32: 32-bit floating point
* f64: 64-bit floating point

Integer signed/unsigned determined by operators.
</script></section><section  data-markdown><script type="text/template">
## WebAssembly Memory

* Sandboxed linear memory
* No aliasing
* Multiple of 64 KiB in MVP
* Accessible from JavaScript as ArrayBuffer
</script></section><section  data-markdown><script type="text/template">
## WebAssembly Use Cases

* Improve load times of web apps
* Implement web apps in other languages than JS
* Run CPU bound workloads in browsers
* Use existing C/C++, Java, ... libraries in browsers
* Hybrid native mobile apps
* Run same binaries on different IoT devices

Also see: https://webassembly.org/docs/use-cases/
</script></section><section  data-markdown><script type="text/template">
<!-- .slide: class="master02" -->

# Actual Code
</script></section><section  data-markdown><script type="text/template">
## WebAssembly "Hello, World!"

<span style="display: block; text-align:left;margin: 2.5rem auto -1rem auto; width: 90%;">hello.c:</span>
```c
#include <webassembly.h>

extern void printMessage(int);

export void hello() {
  printMessage(42);
}
```
</script></section><section  data-markdown><script type="text/template">
## WebAssembly "Hello, World!"

<span style="display: block; text-align:left;margin: 2.5rem auto -1rem auto; width: 90%;">hello.js:</span>
```javascript
function printMessage(message) {
    document.getElementById("message").innerHTML = message;
}

var importObject = {
    env: {
        memory: new WebAssembly.Memory({ initial: 2, maximum: 10 }),
        printMessage
    }
};

WebAssembly.instantiateStreaming(
    fetch('wasm/hello.wasm'), importObject)
        .then(module => { module.instance.exports.hello() });
```
</script></section><section  data-markdown><script type="text/template">
## WebAssembly "Hello, World!"

<span style="display: block; text-align:left;margin: 2.5rem auto -1rem auto; width: 90%;">Compile:</span>
```bash
git clone https://github.com/puzzle/wasm-hello
cd wasm-hello
docker run --rm -it -p 8080:8080 -v `pwd`:/src node:8 /bin/bash
cd /src
npm install
npx gulp
```
</script></section><section  data-markdown><script type="text/template">
## WebAssembly "Hello, World!"

<span style="display: block; text-align:left;margin: 2.5rem auto -1rem auto; width: 90%;">hello.wasm (generated):</span>
```wasm
(module
  (type $t0 (func (param i32)))
  (type $t1 (func))
  (import "env" "printMessage" (func $env.printMessage (type $t0)))
  (import "env" "memory" (memory $env.memory 1))
  (func $hello (type $t1)
    i32.const 42
    call $env.printMessage)
  (table $T0 0 anyfunc)
  (export "hello" (func $hello))
  (data (i32.const 4) " '\00\00"))
```
</script></section><section  data-markdown><script type="text/template">
<!-- .slide: class="master02" -->

# Do it Yourself
</script></section><section  data-markdown><script type="text/template">
## Look at some Demos

* [Funky Karts](https://www.funkykarts.rocks/demo.html)
* [Epic Zen Garden](https://s3.amazonaws.com/mozilla-games/ZenGarden/EpicZenGarden.html)
* [Sun Temple](http://s3.amazonaws.com/mozilla-games/tmp/2017-02-21-SunTemple/SunTemple.html)
* [Qt for WebAssembly Examples](http://blog.qt.io/blog/2018/05/22/qt-for-webassembly-examples/)
</script></section><section  data-markdown><script type="text/template">
## Study

* [WebAssembly Documentation](https://webassembly.org/docs/high-level-goals/)
* [Mozilla WebAssembly Documentation](https://developer.mozilla.org/en-US/docs/WebAssembly)
* [Awesome Wasm](https://github.com/mbasso/awesome-wasm)
* [Awesome WebAssembly Languages](https://github.com/appcypher/awesome-wasm-langs)
* [WebAssembly Reference Manual](https://github.com/sunfishcode/wasm-reference-manual/blob/master/WebAssembly.md)
</script></section><section  data-markdown><script type="text/template">
## Try and Modify

* [WebAssembly "Hello, World!" in C](https://github.com/puzzle/wasm-hello)
* [WebAssembly "Hello, World!" in Java](https://github.com/puzzle/wasm-hello-java)
* [Wheel of WebAssembly](https://github.com/boyanio/wasm-wheel), also see next slide
</script></section><section  data-markdown><script type="text/template">
## Try "Weel of WebAssembly"

```bash
git clone https://github.com/boyanio/wasm-wheel
cd wasm-wheel
git checkout d626ffc
docker run --rm -it -p 8080:8080 -v `pwd`:/src \
    quay.io/dtschan/wasm-wheel /bin/bash
npm install
npx gulp build-metadata build-wasm-folder build-wasm-assemblyscript \
    build-wasm-c build-wasm-java build-wasm-go
npx gulp serve
```

Then visit http://localhost:8080/.
</script></section><section  data-markdown><script type="text/template">
## Try Emscripten "Hello, World!"

```bash
mkdir hello
cd hello
cat << EOF > hello.c
#include <stdio.h>
int main(int argc, char ** argv) {
  printf("Hello, world!\n");
}
EOF

docker run --rm -it -p 8080:8080 -v `pwd`:/src \
    trzeci/emscripten /bin/bash
emcc hello.c -s WASM=1 -o hello.html
emrun --no_browser --hostname 0.0.0.0 --port 8080 .
```

Then visit http://localhost:8080/hello.html.
</script></section><section  data-markdown><script type="text/template">
## Research

* Do the WebAssembly demos/examples run on my mobile?
* How are strings handled in the different examples?
* How does Go handle garbage collection in Wasm?
* How to extend [this Dockerfile](https://github.com/dtschan/wasm-wheel/blob/docker/docker/Dockerfile) to get the Kotlin example working
</script></section><section  data-markdown><script type="text/template">
<!-- .slide: class="master02" -->

# Discover WebAssembly Yourself
</script></section></div>
        </div>

        <script src="./lib/js/head.min.js"></script>
        <script src="./js/reveal.js"></script>

        <script>
            function extend() {
              var target = {};
              for (var i = 0; i < arguments.length; i++) {
                var source = arguments[i];
                for (var key in source) {
                  if (source.hasOwnProperty(key)) {
                    target[key] = source[key];
                  }
                }
              }
              return target;
            }

            // Optional libraries used to extend on reveal.js
            var deps = [
              { src: './lib/js/classList.js', condition: function() { return !document.body.classList; } },
              { src: './plugin/markdown/marked.js', condition: function() { return !!document.querySelector('[data-markdown]'); } },
              { src: './plugin/markdown/markdown.js', condition: function() { return !!document.querySelector('[data-markdown]'); } },
              { src: './plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
              { src: './plugin/zoom-js/zoom.js', async: true },
              { src: './plugin/notes/notes.js', async: true },
              { src: './plugin/math/math.js', async: true }
            ];

            // default options to init reveal.js
            var defaultOptions = {
              controls: true,
              progress: true,
              history: true,
              center: true,
              transition: 'default', // none/fade/slide/convex/concave/zoom
              dependencies: deps
            };

            // options from URL query string
            var queryOptions = Reveal.getQueryHash() || {};

            var options = {};
            options = extend(defaultOptions, options, queryOptions);
            Reveal.initialize(options);
        </script>
        
    </body>
</html>
